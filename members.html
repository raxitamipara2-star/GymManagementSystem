<!DOCTYPE html>
<html>
<head>
  <title>Members</title>

  <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">

  <style>
    body { font-family:Poppins; background:#f2f4f8; margin:0; }
    header { background:#111827; color:white; padding:15px; text-align:center; }
    table { width:100%; background:white; border-collapse:collapse; margin-top:20px; }
    th, td { padding:12px; border-bottom:1px solid #ddd; }
    button { padding:6px 12px; background:red; color:white; border:none; border-radius:4px; cursor:pointer; }
  </style>
</head>
<body>

<header>
  <h2>Registered Members</h2>
</header>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="members"></tbody>
</table>

<script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCux0iKyvFaZ7c8Gc8Tihcl_tULz4vh0Ok",
  authDomain: "gym-management-system-5829d.firebaseapp.com",
  projectId: "gym-management-system-5829d"
});

const auth = firebase.auth();
const db = firebase.firestore();

let isAdmin = false;

// Protect page and check role
auth.onAuthStateChanged(user=>{
  if(!user){
    window.location="admin-login.html";
  } else {
    db.collection("users").doc(user.uid).get().then(doc=>{
      if(!doc.exists || doc.data().role !== "admin"){
        alert("Access Denied");
        window.location="index.html";
      } else {
        isAdmin = true;
        loadMembers();
      }
    });
  }
});

// Load members from USERS collection
function loadMembers(){
  db.collection("users").where("role","==","member").onSnapshot(snapshot=>{
    members.innerHTML = "";
    snapshot.forEach(doc=>{
      const m = doc.data();
      members.innerHTML += `
        <tr>
          <td>${m.name}</td>
          <td>${m.email}</td>
          <td>
            <button onclick="deleteMember('${doc.id}')">Delete</button>
          </td>
        </tr>
      `;
    });
  });
}

// Delete member (Firestore + Auth)
function deleteMember(uid){
  if(!confirm("Delete this member?")) return;

  // Delete from Firestore
  db.collection("users").doc(uid).delete()
  .then(()=>{
    alert("Member deleted from database");
  })
  .catch(err=>alert(err.message));
}
</script>

</body>
</html>
